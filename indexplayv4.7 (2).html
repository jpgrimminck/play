
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Play</title>

  <!-- Configuraci√≥n para instalar como app en iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Play">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Escala responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- √çconos de la app -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <style>
    /* ====================================================================== */
    /* =======================  ESTILOS GENERALES  ========================== */
    /* ====================================================================== */
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;      /* Evita scroll de fondo */
      height: 100%;
      background-color: #363739; /* Fondo gris oscuro solicitado */
      font-family: -apple-system, BlinkMacSystemFont, 'San Francisco', 'Helvetica Neue', sans-serif;
    }

    /* Contenedor principal dividido en barra lateral y √°rea de reproducci√≥n */
    .container {
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }

    /* ====================================================================== */
    /* ===============  BARRA LATERAL CON MINIATURAS (SIDEBAR) ============== */
    /* ====================================================================== */
    .sidebar {
      width: 100px;                     /* Ancho fijo */
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      overflow-y: auto;                 /* Scroll vertical solo aqu√≠ */
      -webkit-overflow-scrolling: touch;/* Inercia en iOS */
      gap: 0;                           /* Sin espacios extra */
      /* Coloca la barra sobre el ‚Äúnotch‚Äù/status‚Äëbar en iPhone */
      margin-top: calc(-1 * env(safe-area-inset-top));
    }

    /* Botones de miniaturas */
    .sidebar .miniatura {
      /* *IMPORTANTE*: sin padding extra para que NO aparezcan m√°rgenes en desktop */
      margin: 0;
      padding: 0;
      line-height: 0;
      vertical-align: top;
      box-sizing: border-box;
      position: relative;
      width: 100px;
      aspect-ratio: 1/1;                /* Mantiene 1:1 */
      font-size: 0;                     /* Oculta texto */
      background: #555;
      background-size: cover;
      background-position: center;
      border: none;
      color: white;
      cursor: pointer;
    }

    /* N√∫mero sobre cada miniatura */
    .sidebar .miniatura::after {
      content: attr(data-label);
      position: absolute;
      bottom: 4px;
      right: 4px;
      font-size: 14px;
      background-color: black;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      line-height: 1;
      z-index: 2;
    }

    /* Efecto hover s√≥lo visible en computadora */
    @media (hover: hover) {
      .sidebar .miniatura:hover {
        filter: brightness(1.3);
      }
    }

    /* ====================================================================== */
    /* ===================  √ÅREA PRINCIPAL DE REPRODUCCI√ìN  ================= */
    /* ====================================================================== */
    .main {
      flex-grow: 1;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      position: relative;
      overflow: hidden;
    }

    /* Car√°tula del tema actual */
    .caratula {
      width: 200px;
      height: 200px;
      border-radius: 30px;
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      /* color de respaldo (carga) */
      background-color: red;
    }

    /* Informaci√≥n textual */
    .info { width: 200px; text-align: left; }

    .nombreCancion {
      font-size: 1.25rem; /* 20‚Äì22¬†px aprox. */
      font-weight: 600;
      color: #FFFFFF;
    }
    .artista {
      font-size: 0.9rem;  /* 14‚Äì16¬†px aprox. */
      font-weight: 400;
      color: #B3B3B3;
    }

    /* Barra de progreso */
    #seekBar { width: 80%; }

    /* Bot√≥n play / pausa redondo */
    #playPause {
      width: 150px;
      height: 150px;
      border: none;
      border-radius: 50%;
      background: white;
      color: black;
      font-size: 64px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    #playPause:hover { background: #eee; }

    /* √çconos de play / pause construidos con CSS */
    .icon { width: 0; height: 0; border-style: solid; }
    .play-icon { border-width: 20px 0 20px 35px; border-color: transparent transparent transparent black; }

    .pause-icon { display: flex; gap: 10px; }
    .pause-icon div { width: 10px; height: 40px; background: black; }

    /* Bot√≥n de guitarra para alternar audio secundario */
    #guitarraBtn {
      width: 50px;
      height: 50px;
      position: absolute;
      top: calc(50% - 310px);
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;

      display: none;                    /* Visible solo en covers con audio alternativo */
      align-items: center;
      justify-content: center;

      border: none;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 10px gray;
      cursor: pointer;
    }
    #guitarraBtn.active {              /* Resalta en rojo cuando est√° activo */
      box-shadow: 0 0 10px red !important;
    }

    /* Versi√≥n en esquina */
    .version {
      position: absolute;
      bottom: 10px;
      right: 20px;
      font-size: 16px;
      color: #999;
    }
  </style>
</head>

<body>
  <!-- ===========================  ESTRUCTURA HTML  =========================== -->
  <div class="container">
    <!-- Barra lateral -->
    <div class="sidebar">
      <div id="miniaturasContainer"></div>
    </div>

    <!-- Secci√≥n principal -->
    <div class="main">
      <button id="guitarraBtn"><span style="font-size:28px;">üé∏</span></button>
      <div class="caratula" id="cover"></div>
      <div class="info">
        <div class="nombreCancion" id="nombreCancion"></div>
        <div class="artista"        id="artista"></div>
      </div>
      <input type="range" id="seekBar" value="0" min="0" step="1">
      <button id="playPause"><div id="icon" class="icon play-icon"></div></button>
    </div>
  </div>

  <!-- Etiqueta de versi√≥n -->
  
    <div class="version" id="version-btn" style="cursor: pointer; user-select: none;">
    Versi√≥n 4.7
  </div>
    <div id="spinner" style="
      display: none;
      position: fixed;
      bottom: 10px;
      right: 100px;
      width: 20px;
      height: 20px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #555;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 1000;">
    </div>
    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
    <script>
      document.getElementById('version-btn').addEventListener('click', function() {
        const spinner = document.getElementById('spinner');
        spinner.style.display = 'block';

        setTimeout(() => {
          window.location.reload(true);
        }, 1000);
      });
    </script>
    

  <!-- ===========================  AUDIOS OCULTOS  =========================== -->
  <audio id="audio"></audio>
  <audio id="audioAlt" style="display:none;"></audio>

  <!-- ==============================  SCRIPTS  =============================== -->
  <script>
  /* --------------------------------------------------------------------------
     VARIABLES Y CONSTANTES GLOBALES
  -------------------------------------------------------------------------- */
  const totalCovers = 57;               // Total de car√°tulas
  const coversConGuitarra = [9, 10];    // √çndices que poseen audio sin guitarra

  // Metadatos de canciones (nombre y artista)
  const metadatos = {
      1:  {nombre:'D√≠a de Enero',                         artista:'Shakira'},
      2:  {nombre:'Hey Jude',                             artista:'Beatles'},
      3:  {nombre:'The Scientist',                        artista:'Coldplay'},
      4:  {nombre:'Shake it Off',                         artista:'Taylor Swift'},
      5:  {nombre:'Main Theme',                           artista:'Gravity Falls'},
      6:  {nombre:'Riptide',                              artista:'Vance Joy'},
      7:  {nombre:'El Cami√≥n de Samu',                    artista:'Hermanos'},
      8:  {nombre:'Capaz',                                artista:'Alleh & Yorghaki'},
      9:  {nombre:'Drive',                                artista:'Incubus'},
      10: {nombre:"Back to december (Taylor's Version)",  artista:'Taylor Swift'},
      11: {nombre:'Gravity Falls',                        artista:'Pedro y Clemente'},
      12: {nombre:'Burrito Sabanero',                     artista:'Borja y Max'},
      13: {nombre:"I'm still standing",                   artista:'Clemente'},
      14: {nombre:'Diente blanco, No te vayas!',          artista:'Clemente y Celeste'},
      15: {nombre:"Don't Stop Believin'",                 artista:'Journey'},
      16: {nombre:"All of me",                            artista:'John Legend'},
      17: {nombre:"Somewhere Only we Know",               artista:'Keane'},
      18: {nombre:"Someone like You",                     artista:'Adele'},
      19: {nombre:"Podr√© ir a Europa",                    artista:'Mart√≠n y Emma'},
      20: {nombre:"Muerte en Hawaii",                     artista:'Calle 13'},
      21: {nombre:"Pop√≥, As√≠ me llamo yo",                artista:"Mart√≠n y Emma"},
      22: {nombre:"Osito Gominola",                       artista:"Samuel"},
      23: {nombre:"Ritmo Sideral",                        artista:"Clemente"},
      24: {nombre:"Pepita",                               artista:"Samuel"},
      25: {nombre:"De Beb√© a Ni√±o",                       artista:"Emma"},
      26: {nombre:"Steve's Lava Chicken",                 artista:"Minecraft"},
      27: {nombre:"In the Stars",                         artista:"Benson Boone"},
      28: {nombre:"Something just like This",             artista:"The Chainsmokers & Coldplay"},
      29: {nombre:"Zorba",                                artista:"El Griego"},      
      30: {nombre:"Chiu Chiu",                       artista:"Borja"},
      31: {nombre:"Cuando sea mayor",                artista:"Josefa"},
      32: {nombre:"Danke Danke",                     artista:"Emma"},
      33: {nombre:"Do re mi fa sol",                 artista:"Bernardo"},
      34: {nombre:"El colegio es para aprender",     artista:"Emma"},
      35: {nombre:"Enchanted",                       artista:"Clarita"},
      36: {nombre:"Estrellita",                      artista:"Rafael"},
      37: {nombre:"Gallo Pelado",                    artista:"Borja"},
      38: {nombre:"Gohstbuster",                     artista:"Clemente"},
      39: {nombre:"Jurassic Park",                   artista:"Clemente"},
      40: {nombre:"La jardinera",                    artista:"Lucas"},
      41: {nombre:"La Maldita Roberta",              artista:"Mart√≠n"},
      42: {nombre:"Long Live",                       artista:"Clarita"},
      43: {nombre:"Milo el doctor",                  artista:"Pedro"},
      44: {nombre:"Piratas del caribe",              artista:"Raimundo"},
      45: {nombre:"Polka de los perros",             artista:"Clemente"},
      46: {nombre:"Schwarz und weiss",               artista:"Mart√≠n"},
      47: {nombre:"Sky full of stars",               artista:"Josefa"},
      48: {nombre:"Solsito porfavor",                artista:"Emma"},
      49: {nombre:"Star Wars",                       artista:"Lucas"},
      50: {nombre:"Thunderstruck",                   artista:"Lucas"},
      51: {nombre:"Yo nunca vi televisi√≥n",          artista:"Mart√≠n"},
      52: {nombre:"Yo vendo unos ojos negros",       artista:"Eduardo"},
      53: {nombre:"Jurassic Park",                   artista:"Agust√≠n"},
      54: {nombre:"Los monitos",                     artista:"Josefa y Emilio"},
      55: {nombre:"Perdonarte para que",             artista:"Clarita"},
      56: {nombre:"Rodolfo el Reno",                 artista:"Josefa"},
      57: {nombre:"With you",                        artista:"Clarita"},
  };

  /* --------------------------------------------------------------------------
     ELEMENTOS DEL DOM
  -------------------------------------------------------------------------- */
  const miniaturasContainer = document.getElementById('miniaturasContainer');
  const nombreCancionEl     = document.getElementById('nombreCancion');
  const artistaEl           = document.getElementById('artista');
  const audio               = document.getElementById('audio');
  const audioAlt            = document.getElementById('audioAlt');
  const guitarraBtn         = document.getElementById('guitarraBtn');
  const playPauseBtn        = document.getElementById('playPause');
  const icon                = document.getElementById('icon');
  const cover               = document.getElementById('cover');
  const seekBar             = document.getElementById('seekBar');

  /* Estado de audio actual */
  let currentAudio = audio;
  let isAlt        = false;             // ¬øEstamos usando audio alternativo?

  /* --------------------------------------------------------------------------
     FUNCIONES PRINCIPALES
  -------------------------------------------------------------------------- */
  function selectAudio (filename, coverImage, metadata) {
    if (currentAudio && !currentAudio.paused) currentAudio.pause();

    audio.src = filename;
    cover.style.backgroundImage = `url('${coverImage}')`;

    nombreCancionEl.textContent = metadata.nombre;
    artistaEl.textContent       = metadata.artista;

    localStorage.setItem('selectedAudio',   filename);
    localStorage.setItem('selectedCover',   coverImage);
    localStorage.setItem('selectedNombre',  metadata.nombre);
    localStorage.setItem('selectedArtista', metadata.artista);

    if ('mediaSession' in navigator) {
      navigator.mediaSession.metadata = new MediaMetadata({
        title:  metadata.nombre,
        artist: metadata.artista,
        artwork:[{ src: coverImage, sizes:'512x512', type:'image/jpeg' }]
      });
      navigator.mediaSession.setActionHandler('play',  () => { currentAudio.play();  setIcon('pause'); });
      navigator.mediaSession.setActionHandler('pause', () => { currentAudio.pause(); setIcon('play');  });
    }

    const coverIndex = parseInt(filename.match(/(\d+)\.mp3/)[1], 10);
    if (coversConGuitarra.includes(coverIndex)) {
      guitarraBtn.style.display = 'flex';
      guitarraBtn.disabled      = true;
      guitarraBtn.style.filter  = 'grayscale(100%)';
      guitarraBtn.style.opacity = '0.6';
      guitarraBtn.classList.remove('active');

      audioAlt.src = filename.replace('.mp3','_sg.mp3');
      audioAlt.preload = 'auto';
      audioAlt.load();
      audioAlt.addEventListener('canplaythrough', () => {
        guitarraBtn.disabled     = false;
        guitarraBtn.style.filter = 'none';
        guitarraBtn.style.opacity= '1';
      }, {once:true});
    } else {
      guitarraBtn.style.display = 'none';
    }

    currentAudio = audio;
    currentAudio.load();
    seekBar.value = 0;
    seekBar.max   = 1;
    setIcon('play');
  }

  function togglePlay () {
    if (!currentAudio.src) return;
    if (currentAudio.paused) {
      currentAudio.play();
      setIcon('pause');
    } else {
      currentAudio.pause();
      setIcon('play');
    }
  }

  function setIcon (state) {
    if (state === 'play') {
      icon.className = 'icon play-icon';
      icon.innerHTML = '';
    } else {
      icon.className = 'pause-icon';
      icon.innerHTML = '<div></div><div></div>';
    }
  }

  [audio, audioAlt].forEach(aud => {
    aud.addEventListener('timeupdate', e => {
      if (!isNaN(e.target.duration)) {
        seekBar.max   = Math.floor(e.target.duration);
        seekBar.value = Math.floor(e.target.currentTime);
      }
    });
    aud.addEventListener('ended', () => setIcon('play'));
  });

  seekBar.addEventListener('input', () => {
    currentAudio.currentTime = seekBar.value;
  });

  playPauseBtn.addEventListener('click', togglePlay);

  guitarraBtn.addEventListener('click', () => {
    const savedAudio = localStorage.getItem('selectedAudio');
    const coverIndex = parseInt(savedAudio.match(/(\d+)\.mp3/)[1], 10);
    if (!coversConGuitarra.includes(coverIndex)) return;

    const time    = currentAudio.currentTime;
    const playing = !currentAudio.paused;

    guitarraBtn.classList.toggle('active');
    isAlt = guitarraBtn.classList.contains('active');
    localStorage.setItem('isAlt', isAlt.toString());

    currentAudio.pause();
    currentAudio = isAlt ? audioAlt : audio;
    currentAudio.currentTime = time;
    if (playing) currentAudio.play();
  });

  window.addEventListener('DOMContentLoaded', () => {
    const savedAudio   = localStorage.getItem('selectedAudio')   || '1.mp3';
    const savedCover   = localStorage.getItem('selectedCover')   || 'cover1.jpeg';
    const savedNombre  = localStorage.getItem('selectedNombre')  || metadatos[1].nombre;
    const savedArtista = localStorage.getItem('selectedArtista') || metadatos[1].artista;
    const savedIsAlt   = localStorage.getItem('isAlt') === 'true';

    cover.style.backgroundImage = `url('${savedCover}')`;
    nombreCancionEl.textContent = savedNombre;
    artistaEl.textContent       = savedArtista;
    audio.src = savedAudio;

    const coverIndex = parseInt(savedAudio.match(/(\d+)\.mp3/)[1], 10);
    guitarraBtn.style.display = coversConGuitarra.includes(coverIndex) ? 'flex' : 'none';

    if (coversConGuitarra.includes(coverIndex) && savedIsAlt) {
      isAlt        = true;
      guitarraBtn.classList.add('active');
      currentAudio = audioAlt;
    } else {
      isAlt        = false;
      currentAudio = audio;
    }

    audio.addEventListener('loadedmetadata', () => setIcon('play'));

    /* Generar botones de miniaturas en orden inverso */
    for (let i = totalCovers; i >= 1; i--) {
      const btn = document.createElement('button');
      btn.className = 'miniatura';
      btn.setAttribute('data-label', i);
      btn.style.backgroundImage = `url('cover${i}.jpeg')`;
      btn.onclick = () => selectAudio(`${i}.mp3`, `cover${i}.jpeg`, metadatos[i]);
      miniaturasContainer.appendChild(btn);
    }
  });
  </script>
</body>
</html>
